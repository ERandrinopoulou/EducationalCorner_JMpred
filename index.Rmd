---
title: "Dynamic prediction using joint models of longitudinal and time-to-event data"
author: "Eleni-Rosalina Andrinopoulou, Department of Biostatistics, Erasmus Medical Center"
date: "`r Sys.setenv(LANG = 'en_US.UTF-8'); format(Sys.Date(), '%d %B %Y')`"
output: 
   html_document:
     toc: true
     toc_float:
       collapsed: false
     includes:
         after_body: footerEA.html
---

<span style="color:red; font-weight:bold; font-size:4em;"> Under construction </span>


In this webpage, we describe and show the analysis that was performed in the manuscipt: _Dynamic prediction using joint models of longitudinal and time-to-event data_

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = NA, message=FALSE, warning=FALSE)
library(JMbayes)
library(lattice)
library(splines)
```

# Packages 

The <code>R</code> packages and versions that are used cen be seen below:

```{r packages2, results='asis', echo=FALSE}
library(dplyr)
library(kableExtra)
x <- c("JMbayes", "lattice", "splines")
Rpack <- lapply(x, FUN = function(x) packageVersion(x))
Rpack <- lapply(Rpack, FUN = function(x) as.character(x))
names(Rpack) <- x

Rpack <- data.frame(R = R.Version()$version.string, (Rpack))
colnames(Rpack)[1] <- "**Software**:"

kable(t(Rpack),  caption = "", format = "html") %>%
column_spec(1, width = c("7em")) %>%
column_spec(2, width = c("15em"))
```

\

# Analysis
A first imporant step is to investigate the data set. More details can be found in the tab **Data**.

## Fit a joint model

A mixed-effects submodel can be fitted using the <code>lme</code> function as:
```{r, cache=TRUE}
fit_nonlinear2 <- lme(log(serBilir) ~ ns(year, 3) + age + sex + drug, 
                      random = list(id = pdDiag(form = ~ ns(year, 3))), 
                      data = pbc2)
```

A survival submodel can be fitted using the <code>coxph</code> function as:
```{r, cache=TRUE}
survFit.pbc <- coxph(Surv(years, status2) ~ age + sex + drug, data = pbc2.id, x = TRUE)
```

Then the joint model can be fitted using the <code>jointModelBayes</code> function as:
```{r, cache=TRUE}
jointFit.pbc <- jointModelBayes(fit_nonlinear2, survFit.pbc, timeVar = "year", 
                                baseHaz = "regression-splines", verbose = FALSE)
summary(jointFit.pbc)
```

## Obtain dynamic predictions

## Evaluate the predictions